diff --git a/CMakeLists.txt b/CMakeLists.txt
index d0ecf6e..fad10e4 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -22,7 +22,17 @@ if (POLICY CMP0156)
   cmake_policy(SET CMP0156 NEW)
 endif()
 
-set(OMIM_ROOT ${CMAKE_SOURCE_DIR})
+# Use CMAKE_CURRENT_SOURCE_DIR so this works when added as subdirectory
+set(OMIM_ROOT ${CMAKE_CURRENT_SOURCE_DIR})
+
+# On Windows, resolve symlinks to avoid MAX_PATH issues (260 char limit).
+# Flutter creates very long symlink paths like .plugin_symlinks/agus_maps_flutter/...
+# which can exceed MAX_PATH when combined with deep boost header paths.
+if (WIN32)
+  get_filename_component(OMIM_ROOT "${OMIM_ROOT}" REALPATH)
+  message(STATUS "Resolved OMIM_ROOT (for MAX_PATH): ${OMIM_ROOT}")
+endif()
+
 set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${OMIM_ROOT}/cmake")
 
 set(CMAKE_POSITION_INDEPENDENT_CODE ON)
@@ -96,7 +106,14 @@ if (PLATFORM_WIN)
 endif()
 
 # Built-in CMake configurations: Debug, Release, RelWithDebInfo, MinSizeRel
-if (${CMAKE_BUILD_TYPE} STREQUAL "Debug")
+# Use generator expressions for multi-config generators (Visual Studio, Xcode)
+if (CMAKE_CONFIGURATION_TYPES)
+  # Multi-config generator (Visual Studio, Xcode)
+  add_compile_definitions(
+    $<$<CONFIG:Debug>:DEBUG>
+    $<$<NOT:$<CONFIG:Debug>>:RELEASE>
+  )
+elseif (${CMAKE_BUILD_TYPE} STREQUAL "Debug")
   add_definitions(-DDEBUG)
   if (NOT MSVC)
     add_compile_options(-fno-omit-frame-pointer)
@@ -107,7 +124,8 @@ elseif (${CMAKE_BUILD_TYPE} MATCHES "Rel")
     add_compile_options(-O3 $<$<CXX_COMPILER_ID:GNU>:-flto=auto>)
   endif()
 else()
-  message(FATAL_ERROR "Unknown build type: " ${CMAKE_BUILD_TYPE})
+  message(WARNING "Unknown or empty build type: ${CMAKE_BUILD_TYPE}, defaulting to RELEASE")
+  add_definitions(-DRELEASE)
 endif()
 
 if (${CMAKE_BUILD_TYPE} STREQUAL "RelWithDebInfo")
@@ -150,7 +168,7 @@ find_package(Threads REQUIRED)
 
 # Scripts
 
-if (NOT PLATFORM_IPHONE AND NOT PLATFORM_ANDROID)
+if (NOT PLATFORM_IPHONE AND NOT PLATFORM_ANDROID AND NOT SKIP_QT)
   list(APPEND qt_components Core Network)
   if (NOT SKIP_QT_GUI OR NOT SKIP_TESTS OR PYBINDINGS)
     list(APPEND qt_components Widgets)
@@ -170,7 +188,8 @@ if (NOT PLATFORM_IPHONE AND NOT PLATFORM_ANDROID)
 endif()
 
 # To allow #include "base/file_name.hpp" in all sources.
-include_directories("${CMAKE_HOME_DIRECTORY}" "${CMAKE_HOME_DIRECTORY}/libs" "${CMAKE_HOME_DIRECTORY}/tools")
+# Use OMIM_ROOT instead of CMAKE_HOME_DIRECTORY so this works when added as subdirectory
+include_directories("${OMIM_ROOT}" "${OMIM_ROOT}/libs" "${OMIM_ROOT}/tools")
 
 if (USE_PCH)
   message(STATUS "Precompiled headers are ON")
@@ -200,6 +219,86 @@ endif()
 
 find_package(ZLIB REQUIRED)
 
+# Boost configuration for modular header layout
+# The boost submodule uses modular header layout (headers in libs/*/include/boost/)
+# We need to add include paths for all used boost libraries
+# NOTE: This MUST be set BEFORE add_subdirectory(3party) so the paths are visible
+set(BOOST_INCLUDE_DIRS
+  "${OMIM_ROOT}/3party/boost/libs/algorithm/include"
+  "${OMIM_ROOT}/3party/boost/libs/align/include"
+  "${OMIM_ROOT}/3party/boost/libs/any/include"
+  "${OMIM_ROOT}/3party/boost/libs/array/include"
+  "${OMIM_ROOT}/3party/boost/libs/assert/include"
+  "${OMIM_ROOT}/3party/boost/libs/atomic/include"
+  "${OMIM_ROOT}/3party/boost/libs/bind/include"
+  "${OMIM_ROOT}/3party/boost/libs/chrono/include"
+  "${OMIM_ROOT}/3party/boost/libs/circular_buffer/include"
+  "${OMIM_ROOT}/3party/boost/libs/concept_check/include"
+  "${OMIM_ROOT}/3party/boost/libs/config/include"
+  "${OMIM_ROOT}/3party/boost/libs/container/include"
+  "${OMIM_ROOT}/3party/boost/libs/container_hash/include"
+  "${OMIM_ROOT}/3party/boost/libs/conversion/include"
+  "${OMIM_ROOT}/3party/boost/libs/core/include"
+  "${OMIM_ROOT}/3party/boost/libs/date_time/include"
+  "${OMIM_ROOT}/3party/boost/libs/describe/include"
+  "${OMIM_ROOT}/3party/boost/libs/detail/include"
+  "${OMIM_ROOT}/3party/boost/libs/dynamic_bitset/include"
+  "${OMIM_ROOT}/3party/boost/libs/endian/include"
+  "${OMIM_ROOT}/3party/boost/libs/exception/include"
+  "${OMIM_ROOT}/3party/boost/libs/foreach/include"
+  "${OMIM_ROOT}/3party/boost/libs/format/include"
+  "${OMIM_ROOT}/3party/boost/libs/function/include"
+  "${OMIM_ROOT}/3party/boost/libs/function_types/include"
+  "${OMIM_ROOT}/3party/boost/libs/functional/include"
+  "${OMIM_ROOT}/3party/boost/libs/fusion/include"
+  "${OMIM_ROOT}/3party/boost/libs/geometry/include"
+  "${OMIM_ROOT}/3party/boost/libs/integer/include"
+  "${OMIM_ROOT}/3party/boost/libs/intrusive/include"
+  "${OMIM_ROOT}/3party/boost/libs/io/include"
+  "${OMIM_ROOT}/3party/boost/libs/iterator/include"
+  "${OMIM_ROOT}/3party/boost/libs/lambda/include"
+  "${OMIM_ROOT}/3party/boost/libs/lexical_cast/include"
+  "${OMIM_ROOT}/3party/boost/libs/math/include"
+  "${OMIM_ROOT}/3party/boost/libs/move/include"
+  "${OMIM_ROOT}/3party/boost/libs/mp11/include"
+  "${OMIM_ROOT}/3party/boost/libs/mpl/include"
+  "${OMIM_ROOT}/3party/boost/libs/multiprecision/include"
+  "${OMIM_ROOT}/3party/boost/libs/numeric/conversion/include"
+  "${OMIM_ROOT}/3party/boost/libs/optional/include"
+  "${OMIM_ROOT}/3party/boost/libs/phoenix/include"
+  "${OMIM_ROOT}/3party/boost/libs/polygon/include"
+  "${OMIM_ROOT}/3party/boost/libs/pool/include"
+  "${OMIM_ROOT}/3party/boost/libs/predef/include"
+  "${OMIM_ROOT}/3party/boost/libs/preprocessor/include"
+  "${OMIM_ROOT}/3party/boost/libs/proto/include"
+  "${OMIM_ROOT}/3party/boost/libs/qvm/include"
+  "${OMIM_ROOT}/3party/boost/libs/random/include"
+  "${OMIM_ROOT}/3party/boost/libs/range/include"
+  "${OMIM_ROOT}/3party/boost/libs/ratio/include"
+  "${OMIM_ROOT}/3party/boost/libs/rational/include"
+  "${OMIM_ROOT}/3party/boost/libs/regex/include"
+  "${OMIM_ROOT}/3party/boost/libs/serialization/include"
+  "${OMIM_ROOT}/3party/boost/libs/smart_ptr/include"
+  "${OMIM_ROOT}/3party/boost/libs/spirit/include"
+  "${OMIM_ROOT}/3party/boost/libs/stacktrace/include"
+  "${OMIM_ROOT}/3party/boost/libs/static_assert/include"
+  "${OMIM_ROOT}/3party/boost/libs/system/include"
+  "${OMIM_ROOT}/3party/boost/libs/throw_exception/include"
+  "${OMIM_ROOT}/3party/boost/libs/tokenizer/include"
+  "${OMIM_ROOT}/3party/boost/libs/tti/include"
+  "${OMIM_ROOT}/3party/boost/libs/tuple/include"
+  "${OMIM_ROOT}/3party/boost/libs/type_index/include"
+  "${OMIM_ROOT}/3party/boost/libs/type_traits/include"
+  "${OMIM_ROOT}/3party/boost/libs/typeof/include"
+  "${OMIM_ROOT}/3party/boost/libs/unordered/include"
+  "${OMIM_ROOT}/3party/boost/libs/utility/include"
+  "${OMIM_ROOT}/3party/boost/libs/uuid/include"
+  "${OMIM_ROOT}/3party/boost/libs/variant/include"
+  "${OMIM_ROOT}/3party/boost/libs/variant2/include"
+  "${OMIM_ROOT}/3party/boost/libs/winapi/include"
+)
+include_directories(${BOOST_INCLUDE_DIRS})
+
 # Include 3party dependencies.
 add_subdirectory(3party)
 
@@ -209,38 +308,48 @@ if (PLATFORM_DESKTOP AND NOT WITH_SYSTEM_PROVIDED_3PARTY)
   include_directories("${PROJECT_BINARY_DIR}/3party/gflags/include")
 endif()
 
-# Fix for #include <boost/regex.hpp>
-include_directories("${OMIM_ROOT}/3party/boost")
-
-# Used in qt/ and shaders/
+# Python3 is used in shaders/ for shader preprocessing (all platforms)
 find_package(Python3 REQUIRED COMPONENTS Interpreter)
 
-execute_process(
-    COMMAND ${Python3_EXECUTABLE} -c "import google.protobuf; 
+# Protobuf check is only needed for desktop builds with Qt (generator tools)
+if (PLATFORM_DESKTOP AND NOT SKIP_QT)
+  execute_process(
+      COMMAND ${Python3_EXECUTABLE} -c "import google.protobuf; 
 print(google.protobuf.__version__)"
-    RESULT_VARIABLE PROTOBUF_CHECK
-    OUTPUT_VARIABLE PROTOBUF_VERSION
-    OUTPUT_STRIP_TRAILING_WHITESPACE
-    ERROR_QUIET
-)
+      RESULT_VARIABLE PROTOBUF_CHECK
+      OUTPUT_VARIABLE PROTOBUF_VERSION
+      OUTPUT_STRIP_TRAILING_WHITESPACE
+      ERROR_QUIET
+  )
 
-if(PROTOBUF_CHECK EQUAL 0)
-    if(PROTOBUF_VERSION VERSION_LESS "4.0.0")
-        message(STATUS "Python protobuf ${PROTOBUF_VERSION} found (< 4.0)")
-    else()
-        message(FATAL_ERROR "Python protobuf ${PROTOBUF_VERSION} found, but version < 4.0 required")
-    endif()
-else()
-    message(FATAL_ERROR "Python protobuf not found. Install version <4.0")
+  if(PROTOBUF_CHECK EQUAL 0)
+      if(PROTOBUF_VERSION VERSION_LESS "4.0.0")
+          message(STATUS "Python protobuf ${PROTOBUF_VERSION} found (< 4.0)")
+      else()
+          message(FATAL_ERROR "Python protobuf ${PROTOBUF_VERSION} found, but version < 4.0 required")
+      endif()
+  else()
+      message(FATAL_ERROR "Python protobuf not found. Install version <4.0")
+  endif()
 endif()
 
 
 add_subdirectory(libs)
 
 if (PLATFORM_DESKTOP)
-  add_subdirectory(dev_sandbox)
-  add_subdirectory(generator)
-  add_subdirectory(tools)
+  # dev_sandbox has POSIX-only code and GLFW dependencies not needed for Flutter builds
+  if (NOT WIN32)
+    add_subdirectory(dev_sandbox)
+  endif()
+  # generator tools require their own platform implementations with GetPlatform()
+  # Skip on Windows Flutter builds as we provide our own platform impl
+  if (NOT WIN32)
+    add_subdirectory(generator)
+  endif()
+  # tools has boost/mp11 issues on MSVC; not needed for Flutter plugin builds
+  if (NOT WIN32)
+    add_subdirectory(tools)
+  endif()
   if (NOT SKIP_QT_GUI)
     add_subdirectory(qt)
   endif()
@@ -255,3 +364,5 @@ omim_add_test_subdirectory(libs/qt_tstfrm)
 if (PLATFORM_ANDROID)
   add_subdirectory(android/sdk/src/main/cpp)
 endif()
+
+

