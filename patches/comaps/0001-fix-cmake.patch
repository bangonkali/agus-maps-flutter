diff --git a/CMakeLists.txt b/CMakeLists.txt
index d0ecf6e3..3ba5e1af 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -22,7 +22,8 @@ if (POLICY CMP0156)
   cmake_policy(SET CMP0156 NEW)
 endif()
 
-set(OMIM_ROOT ${CMAKE_SOURCE_DIR})
+# Use CMAKE_CURRENT_SOURCE_DIR so this works when added as subdirectory
+set(OMIM_ROOT ${CMAKE_CURRENT_SOURCE_DIR})
 set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${OMIM_ROOT}/cmake")
 
 set(CMAKE_POSITION_INDEPENDENT_CODE ON)
@@ -150,7 +151,7 @@ find_package(Threads REQUIRED)
 
 # Scripts
 
-if (NOT PLATFORM_IPHONE AND NOT PLATFORM_ANDROID)
+if (NOT PLATFORM_IPHONE AND NOT PLATFORM_ANDROID AND NOT SKIP_QT)
   list(APPEND qt_components Core Network)
   if (NOT SKIP_QT_GUI OR NOT SKIP_TESTS OR PYBINDINGS)
     list(APPEND qt_components Widgets)
@@ -170,7 +171,8 @@ if (NOT PLATFORM_IPHONE AND NOT PLATFORM_ANDROID)
 endif()
 
 # To allow #include "base/file_name.hpp" in all sources.
-include_directories("${CMAKE_HOME_DIRECTORY}" "${CMAKE_HOME_DIRECTORY}/libs" "${CMAKE_HOME_DIRECTORY}/tools")
+# Use OMIM_ROOT instead of CMAKE_HOME_DIRECTORY so this works when added as subdirectory
+include_directories("${OMIM_ROOT}" "${OMIM_ROOT}/libs" "${OMIM_ROOT}/tools")
 
 if (USE_PCH)
   message(STATUS "Precompiled headers are ON")
@@ -212,26 +214,29 @@ endif()
 # Fix for #include <boost/regex.hpp>
 include_directories("${OMIM_ROOT}/3party/boost")
 
-# Used in qt/ and shaders/
+# Python3 is used in shaders/ for shader preprocessing (all platforms)
 find_package(Python3 REQUIRED COMPONENTS Interpreter)
 
-execute_process(
-    COMMAND ${Python3_EXECUTABLE} -c "import google.protobuf; 
+# Protobuf check is only needed for desktop builds with Qt (generator tools)
+if (PLATFORM_DESKTOP AND NOT SKIP_QT)
+  execute_process(
+      COMMAND ${Python3_EXECUTABLE} -c "import google.protobuf; 
 print(google.protobuf.__version__)"
-    RESULT_VARIABLE PROTOBUF_CHECK
-    OUTPUT_VARIABLE PROTOBUF_VERSION
-    OUTPUT_STRIP_TRAILING_WHITESPACE
-    ERROR_QUIET
-)
-
-if(PROTOBUF_CHECK EQUAL 0)
-    if(PROTOBUF_VERSION VERSION_LESS "4.0.0")
-        message(STATUS "Python protobuf ${PROTOBUF_VERSION} found (< 4.0)")
-    else()
-        message(FATAL_ERROR "Python protobuf ${PROTOBUF_VERSION} found, but version < 4.0 required")
-    endif()
-else()
-    message(FATAL_ERROR "Python protobuf not found. Install version <4.0")
+      RESULT_VARIABLE PROTOBUF_CHECK
+      OUTPUT_VARIABLE PROTOBUF_VERSION
+      OUTPUT_STRIP_TRAILING_WHITESPACE
+      ERROR_QUIET
+  )
+
+  if(PROTOBUF_CHECK EQUAL 0)
+      if(PROTOBUF_VERSION VERSION_LESS "4.0.0")
+          message(STATUS "Python protobuf ${PROTOBUF_VERSION} found (< 4.0)")
+      else()
+          message(FATAL_ERROR "Python protobuf ${PROTOBUF_VERSION} found, but version < 4.0 required")
+      endif()
+  else()
+      message(FATAL_ERROR "Python protobuf not found. Install version <4.0")
+  endif()
 endif()
 
 
